<!--pages/subject/math/index.wxml-->
<view class="container">
  <view class="header">
    <text class="title">{{name}}</text>
  </view>

  <!-- æ•™å¸ˆåŠŸèƒ½åŒº -->
  <block wx:if="{{userInfo.role === 'teacher'}}">
    <view class="content">
      <!-- ä¸Šä¼ èµ„æ–™æŒ‰é’® -->
      <button class="upload-btn" bindtap="showUploadModal">
        <text class="icon">+</text>
        <text>ä¸Šä¼ èµ„æ–™</text>
      </button>

      <!-- èµ„æ–™åˆ—è¡¨ -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">æ•™å­¦èµ„æ–™</text>
          <text class="section-more" bindtap="goToAllMaterials">æŸ¥çœ‹å…¨éƒ¨</text>
        </view>
        <view class="material-list">
          <material-item 
            wx:for="{{materials}}" 
            wx:key="id"
            item="{{item}}"
            bind:preview="previewMaterial"
            bind:download="downloadMaterial"
          />
        </view>
      </view>

      <!-- ç­çº§ä½œä¸š -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">ç­çº§ä½œä¸š</text>
          <text class="section-more" bindtap="goToAllHomework">æŸ¥çœ‹å…¨éƒ¨</text>
        </view>
        <view class="homework-list">
          <view class="homework-item" wx:for="{{homework}}" wx:key="id">
            <view class="homework-info">
              <text class="homework-title">{{item.title}}</text>
              <text class="homework-meta">æˆªæ­¢æ—¶é—´ï¼š{{item.deadline}}</text>
            </view>
            <view class="homework-status {{item.status === 'active' ? 'active' : ''}}">
              {{item.status === 'active' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- å­¦ç”ŸåŠŸèƒ½åŒº -->
  <block wx:if="{{userInfo.role === 'student'}}">
    <view class="content">
      <!-- æˆ‘çš„ä½œä¸š -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">æˆ‘çš„ä½œä¸š</text>
        </view>
        <view class="homework-list">
          <view class="homework-item" wx:for="{{myHomework}}" wx:key="id">
            <view class="homework-info">
              <text class="homework-title">{{item.title}}</text>
              <text class="homework-meta">æˆªæ­¢æ—¶é—´ï¼š{{item.deadline}}</text>
            </view>
            <button class="submit-btn {{item.submitted ? 'submitted' : ''}}" 
                    bindtap="submitHomework" 
                    data-id="{{item.id}}">
              {{item.submitted ? 'å·²æäº¤' : 'æäº¤ä½œä¸š'}}
            </button>
          </view>
        </view>
      </view>

      <!-- å­¦ä¹ èµ„æ–™ -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">å­¦ä¹ èµ„æ–™</text>
        </view>
        <view class="material-list">
          <material-item 
            wx:for="{{materials}}" 
            wx:key="id"
            item="{{item}}"
            bind:preview="previewMaterial"
            bind:download="downloadMaterial"
          />
        </view>
      </view>

      <!-- æ•°å­¦å·¥å…·ç®± -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">æ•°å­¦å·¥å…·ç®±</text>
        </view>
        <view class="tools-grid">
          <view class="tool-item" bindtap="openCalculator">
            <text class="tool-icon">ğŸ§®</text>
            <text class="tool-name">è®¡ç®—å™¨</text>
          </view>
          <view class="tool-item" bindtap="openFormulas">
            <text class="tool-icon">ğŸ“</text>
            <text class="tool-name">å…¬å¼å¤§å…¨</text>
          </view>
          <view class="tool-item" bindtap="openGraphing">
            <text class="tool-icon">ğŸ“ˆ</text>
            <text class="tool-name">å‡½æ•°å›¾åƒ</text>
          </view>
          <view class="tool-item" bindtap="openGeometry">
            <text class="tool-icon">â­•</text>
            <text class="tool-name">å‡ ä½•ä½œå›¾</text>
          </view>
        </view>
      </view>
    </view>
  </block>
</view>